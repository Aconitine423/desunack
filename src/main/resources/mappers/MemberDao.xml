<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >


<mapper namespace="com.desunack.desunack.DAO.MemberDao">
    <insert id="memberJoin">
        insert into member(m_uid, m_id, m_pw, m_name, m_phone, m_email, m_post, m_address, m_address_detail, m_kind,
                           m_status, m_join_date, m_recent_date)
        values (#{m_uid}, #{m_id}, #{m_pw}, #{m_name}, #{m_phone}, #{m_email}, #{m_post}, #{m_address},
                #{m_address_detail}, #{m_kind}, default, default, default)
    </insert>

    <insert id="customerJoin">
        insert into c_member(c_m_uid, c_nickname, c_gender, c_birth, c_point, c_running_total)
        values (#{m_uid}, #{c_nickname}, #{c_gender}, #{c_birth}, default, default)
    </insert>

    <insert id="sMemberJoin">
        insert into member(m_uid, m_id, m_name, m_pw, m_phone, m_email, m_post, m_address, m_address_detail, m_kind,
                           m_status, m_join_date, m_recent_date)
        values (#{m_uid}, #{m_id}, #{m_name}, #{m_pw}, #{m_phone}, #{m_email}, #{m_post}, #{m_address},
                #{m_address_detail}, #{m_kind}, default, default, default)
    </insert>

    <insert id="sellerJoin">
        insert into s_member(s_m_uid, s_picture, s_account, s_bank, s_delivery, s_seller_num)
        values (#{m_uid}, #{s_picture}, #{s_account}, #{s_bank}, #{s_delivery}, #{s_seller_num})
    </insert>

    <update id="updatePw">
        update member set m_pw = #{ecdpw} where m_id = #{m_id}
    </update>

    <select id="getMemberEntity" resultType="com.desunack.desunack.Entity.MemberEntity">
        select m_uid, m_name, m_post, m_address, m_address_detail, m_kind from member where m_id = #{m_id}
    </select>

    <select id="getCustomerEntity" resultType="com.desunack.desunack.Entity.CustomerEntity">
        select * from c_member where c_m_uid = #{m_id}
    </select>

    <select id="getSellerEntity" resultType="com.desunack.desunack.Entity.SellerEntity">
        select * from s_member where s_m_uid = #{m_id}
    </select>

    <select id="findId" resultType="java.lang.String">
        select m_id from member where m_name = #{m_name} and m_email = #{m_email}
    </select>

    <select id="findPw" resultType="java.lang.Integer">
        select count(*) from member where m_id = #{m_id} and m_email = #{m_email}
    </select>

    <select id="getGoodsSales" resultType="java.lang.String">
        select json_arrayagg(json_object('g_id',g_id,'g_m_uid',g_m_uid,'brand_name',brand_name,'g_name',g_name,'company_name',company_name,
                                         'g_value',g_value, 'g_qty',g_qty,'g_startday',g_startday,'g_endday',g_endday,'g_cat_key',g_cat_key,
                                         'g_image',g_image,'g_detail',g_detail,'g_delivery_kind',g_delivery_kind,'g_status',g_status,
                                         'g_toal_rating',g_total_rating,'g_review_count',g_review_count,'gsa_sales',gsa_sales))
        from goods join goods_sales on goods.g_id = goods_sales.gsa_g_id
        where gsa_gender = #{m_gender} and gsa_age_range = #{m_age} limit 5
    </select>
    <select id="getCompanySales" resultType="java.lang.String">
        select json_arrayagg(json_object('g_id',g_id,'g_m_uid',g_m_uid,'brand_name',brand_name,'g_name',g_name,'company_name',company_name,
                                         'g_value',g_value, 'g_qty',g_qty,'g_startday',g_startday,'g_endday',g_endday,'g_cat_key',g_cat_key,
                                         'g_image',g_image,'g_detail',g_detail,'g_delivery_kind',g_delivery_kind,'g_status',g_status,
                                         'g_toal_rating',g_total_rating,'g_review_count',g_review_count,'gts_sales',gts_sales))
        from goods join goods_total_sales on goods.g_id = goods_total_sales.gts_g_id
        where g_m_uid = #{m_uid} limit 5
    </select>
    <select id="getCustomerInfo" resultType="java.lang.String">
        select json_object('m_uid', m_uid, 'm_id', m_id, 'm_name', m_name, 'm_email', m_email,'m_post', m_post, 'm_address', m_address,
               'm_address_detail', m_address_detail, 'm_phone', m_phone, 'm_join_date', m_join_date, 'm_recent_date', m_recent_date,
               'c_nickname', c_nickname, 'c_gender', c_gender, 'c_birth', c_birth, 'c_point', c_point, 'c_running_total', c_running_total)
        from member join c_member on member.m_uid = c_member.c_m_uid where c_m_uid = #{uid}
    </select>
    <select id="getSellerInfo" resultType="java.lang.String">
        select json_object('m_uid', m_uid, 'm_id', m_id, 'm_name', m_name, 'm_email', m_email, 'm_post', m_post, 'm_address', m_address,
                           'm_address_detail', m_address_detail, 'm_phone', m_phone, 'm_join_date', m_join_date, 'm_recent_date', m_recent_date,
                           's_bank',s_bank, 's_account', s_account, 's_delivery', s_delivery)
        from member join s_member on member.m_uid = s_member.s_m_uid where s_m_uid = #{uid}
    </select>
</mapper>