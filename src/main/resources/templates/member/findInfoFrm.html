<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>아이디/비번 찾기</title>
    <link rel="stylesheet" href="/common/reset.css">
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        /* 공통 설정 */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 2rem;
        }

        /* 탭 */
        .tab-container {
            display: flex;
            width: 100%;
            max-width: 400px; /* .form 과 동일한 최대 너비 */
            margin: 0 auto 2rem; /* 중앙 정렬 + 아래 여백 */
            justify-content: center;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 0.5rem 1rem;
            background: #fff;
            border: none;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }

        .tab:not(:last-child) {
            border-right: 1px solid #ddd;
        }

        .tab.active {
            background: #4a90e2;
            color: #fff;
        }

        /* 폼 컨테이너 */
        .form {
            display: none;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            padding: 2rem;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
        }

        .form.active {
            display: block;
            transform: translateY(0);
        }

        /* 입력창 스타일 */
        .form input[type="text"],
        .form input[type="email"] {
            width: 100%;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .form input:focus {
            border-color: #4a90e2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
            outline: none;
        }

        /* 버튼 스타일 */
        .form button {
            display: inline-block;
            padding: 0.6rem 1.2rem;
            margin-bottom: 1rem;
            font-size: 1rem;
            line-height: 1;
            border: none;
            border-radius: 6px;
            background: #4a90e2;
            color: #fff;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
        }

        .form button:hover {
            background: #357ab8;
        }

        .form button:active {
            transform: scale(0.97);
        }

        /* 결과 영역 스타일 */
        #result-id,
        #result-pw {
            min-height: 3rem;
            padding: 1rem;
            background: #eef5ff;
            border: 1px solid #b3d1ff;
            border-radius: 6px;
            font-size: 0.95rem;
            color: #235a9c;
        }

        /* 반응형 처리 (모바일) */
        @media (max-width: 480px) {
            .form {
                padding: 1rem;
            }

            .tab {
                font-size: 0.9rem;
                padding: 0.6rem 0.8rem;
            }

            .form button {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
<div class="tab-container">
    <button id="tab-find-id" class="tab active">아이디 찾기</button>
    <button id="tab-find-pw" class="tab">비밀번호 찾기</button>
</div>

<!-- 아이디 찾기 폼 -->
<form id="form-find-id" class="form active">
    <input type="text" id="userName" placeholder="이름 또는 사업자명" required/>
    <input type="email" id="userEmail" placeholder="이메일" required/>
    <button type="button" id="btn-randCode-id">인증번호 받기</button>
    <input type="text" id="authCodeId" placeholder="인증번호 입력"/>
    <button type="button" id="btn-verify-id">인증 확인</button>
    <div id="result-id"></div>
</form>

<!-- 비밀번호 찾기 폼 -->
<form id="form-find-pw" class="form">
    <input type="text" id="userId" placeholder="아이디" required/>
    <input type="email" id="userEmailPw" placeholder="이메일" required/>
    <button type="button" id="btn-randCode-pw">인증번호 받기</button>
    <input type="text" id="authCodePw" placeholder="인증번호 입력"/>
    <button type="button" id="btn-verify-pw">인증 확인</button>
    <div id="result-pw"></div>
</form>
</body>
<script th:inline="javascript">
    // 임시로 생성된 인증번호를 저장할 변수
    let generatedAuthCodeId = '';
    let generatedAuthCodePw = '';

    // 탭 전환 로직
    $('.tab').on('click', function () {
        // 모든 탭과 폼에서 'active' 클래스 제거
        $('.tab').removeClass('active');
        $('.form').removeClass('active');
        // 클릭된 탭에 'active' 클래스 추가
        $(this).addClass('active');

        // 해당 탭의 데이터 속성(data-target)을 가져와서 폼에 'active' 클래스 추가
        const targetFormId = $(this).data('target');
        $('#' + targetFormId).addClass('active');

        // 결과 및 입력창 초기화
        $('#result-id').text('');
        $('#authCodeId').val('');
        $('#result-pw').text('');
        $('#authCodePw').val('');
    });

    // 인증번호 생성 함수 (4자리 난수)
    function generateRandomCode() {
        return Math.floor(1000 + Math.random() * 9000);
    }

    // 아이디 찾기 - 인증번호 받기 버튼 클릭 이벤트
    $('#btn-randCode-id').on('click', function () {
        const userName = $('#userName').val();
        const userEmail = $('#userEmail').val();

        if (userName === '' || userEmail === '') {
            alert('이름과 이메일을 모두 입력해주세요.');
            return;
        }

        // 인증번호 생성 및 저장
        generatedAuthCodeId = generateRandomCode();

        // 사용자에게 인증번호를 입력하도록 안내
        alert(`인증번호를 전송했습니다. 이메일로 받은 4자리 숫자를 입력해주세요. (테스트용: ${generatedAuthCodeId})`);

        $('#result-id').text('인증번호가 발송되었습니다.').css('color', '#007bff');
    });

    // 아이디 찾기 - 인증 확인 버튼 클릭 이벤트
    $('#btn-verify-id').on('click', function () {
        const name = $('#userName').val();
        const email = $('#userEmail').val();
        const $autoCodeIdInput = $('#authCodeId').val();

        if ($autoCodeIdInput === '') {
            alert('인증번호를 입력해주세요.');
            return;
        }
        // 입력된 인증번호와 생성된 인증번호 비교
        if (parseInt($autoCodeIdInput) === generatedAuthCodeId) {
            // 성공 시, 서버에서 아이디를 가져와서 표시하는 로직
            axios.post('/member/find-id', {userName: name, userEmail: email})
                .then(res => {
                    const result = res.data;
                    if (result) {
                        $('#result-id').text(`인증에 성공했습니다. 회원님의 아이디는 ${result.data} 입니다.`).css('color', 'green');
                        generatedAuthCodeId = ''; // 인증 완료 후 초기화
                    } else {
                        $('#result-id').text(result.msg);
                    }
                })
                .catch(err => {
                    //서버통신 오류
                    alert('서버 통신중 오류가 발생했습니다.');
                    console.log(err);
                })
        } else {
            $('#result-id').text('인증번호가 일치하지 않습니다.').css('color', 'red');
        }
    });

    // 비밀번호 찾기 - 인증번호 받기 버튼 클릭 이벤트
    $('#btn-randCode-pw').on('click', function () {
        const userId = $('#userId').val();
        const userEmailPw = $('#userEmailPw').val();

        if (userId === '' || userEmailPw === '') {
            alert('아이디와 이메일을 모두 입력해주세요.');
            return;
        }

        // 인증번호 생성 및 저장
        generatedAuthCodePw = generateRandomCode();
        alert(`인증번호를 전송했습니다. 이메일로 받은 4자리 숫자를 입력해주세요. (테스트용: ${generatedAuthCodePw})`);

        $('#result-pw').text('인증번호가 발송되었습니다.').css('color', '#007bff');
    });

    // 비밀번호 찾기 - 인증 확인 버튼 클릭 이벤트
    $('#btn-verify-pw').on('click', function () {
        const userInputCode = $('#authCodePw').val();

        if (userInputCode === '') {
            alert('인증번호를 입력해주세요.');
            return;
        }

        // 입력된 인증번호와 생성된 인증번호 비교
        if (parseInt(userInputCode) === generatedAuthCodePw) {
            // 성공 시, 서버에서 임시 비밀번호를 생성하는 로직이 필요 (임시 코드)
            $('#result-pw').text('인증에 성공했습니다. 입력하신 이메일로 임시 비밀번호가 발송되었습니다.').css('color', 'green');
            generatedAuthCodePw = null; // 인증 완료 후 초기화
        } else {
            $('#result-pw').text('인증번호가 일치하지 않습니다.').css('color', 'red');
        }
    });
</script>
</html>